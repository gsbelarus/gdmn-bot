# Папка Data

## nbrbcurrencies.json

Справочник валют. Если файл отсутствует, то он возьмется с сайта национального банка при запуске сервера. Ключ данных -- поле `Curr_ID` из справочника нацбанка.

```json
{
  "version": "1.0",
  "data": {
    "1": {
      "abbreviation": "ALL",
      "name": {
        "ru": {
          "name": "Албанский лек"
        },
        "en": {
          "name": "Albanian Lek"
        },
        "by": {
          "name": "Албанскі лек"
        }
      }
    },
    "2": {
      "abbreviation": "DZD",
      "name": {
        "ru": {
          "name": "Алжирский динар"
        },
        "en": {
          "name": "Algerian Dinar"
        },
        "by": {
          "name": "Алжырскі дынар"
        }
      }
    },
```

## nbrbrates.json

Курсы валют на дату к белорусскому рублю. В качестве ключа данных используется строковое представление даты в формате `YYYY.MM.DD`. Объект данных представляет собой ассоциацию между  `Curr_ID` валюты и курсом. Данные считываются с сайта национального банка по мере необходимости.

```json
{
  "version": "1.0",
  "data": {
    "2020.04.01": {
      "145": 2.5856,
      "298": 0.03291
    },
```

## customers.json

Список клиентов, использующих данный сервер. Заполняется вручную. В будущем будет изменяться через веб интерфейс. Ключ данных -- токен, он же используется при передаче данных на сервер из сторонней программы. Наименование -- используется везде, где надо показать название предприятия. Список алиасов -- это названия в разных формах, сокращенных, полных и т.п., которые пользователь может вводить в процессе регистрации в системе.

```json
{
  "version": "1.0",
  "data": {
    "bmkk": {
      "name": "ОАО \"Березовский Мясоконсервный Комбинат\"",
      "aliases": [
        "бмкк",
        "березовский мясокомбинат"
      ]
    }
  }
}
```

# Data/Telegram

Данные в этой папке относятся к чат боту Телеграма.

## accountlink.json

Связь между ИД чата и сотрудником предприятия.

```json
{
  "version": "1.0",
  "data": {
    "295774420": {
      "customerId": "brl",
      "employeeId": "568146517_1871619887"
    },
    "529000460": {
      "customerId": "brl",
      "employeeId": "147471809_991395044"
    }
  }
}
```

## dialogstates.json

Текущие состояния чатов.

```json
{
  "version": "1.0",
  "data": {
    "295774420": {
      "type": "LOGGED_IN",
      "lastUpdated": 1587108747023,
      "menuMessageId": 291,
      "db": "2019-12-31T21:00:00.000Z",
      "de": "2020-02-28T21:00:00.000Z",
      "fromDb": "2019-12-31T21:00:00.000Z",
      "fromDe": "2020-01-30T21:00:00.000Z",
      "toDb": "2020-01-31T21:00:00.000Z",
      "toDe": "2020-02-28T21:00:00.000Z"
    },
    "529000460": {
      "type": "GETTING_CONCISE",
      "lastUpdated": 1587471117869,
      "menuMessageId": 309,
      "db": "2019-12-31T21:00:00.000Z",
      "de": "2020-01-30T21:00:00.000Z"
    },
    "903074365": {
      "type": "GETTING_COMPARE",
      "lastUpdated": 1587108348136,
      "menuMessageId": 210
    }
  }
}
```

# Data/Viber

Данные в этой папке относятся к чат боту Вайбера. Файлы такие же, как и для Телеграма.

# Data/Payslip

Папка для хранения данных по расчетным листкам. Данные по предприятию хранятся в отдельной подпапке с именем, соответствующим токену (ИД) этого предприятия.

# Data/Payslip/XXXX

Данные одного предприятия.

## employee.json

Справочник сотрудников предприятия. Справочник формируется на сторонней системе и выгружается через команду `UPLOAD_EMPLOYEE`. Переданные данные **объединяются** со справочником на сервере, а именно: новые записи добавляются, существующие заменяются переданными из сторонней системы. Единственный вариант очистить справочник -- это выполнить полную очистку данных предприятия.  

```json
{
  "version": "1.0",
  "data": {
    "568146517_1871619887": {
      "firstName": "АЛЕКСЕЙ",
      "lastName": "АБАШКИН",
      "patrName": "ВАСИЛЬЕВИЧ",
      "passportId": "3010460E000PB4"
    },
```

## accdedref.json

Справочник позиций расчетного листка. Справочник формируется на сторонней системе и выгружается через команду `UPLOAD_ACCDEDREF`. Переданные данные **объединяются** со справочником на сервере, а именно: новые записи добавляются, существующие заменяются переданными из сторонней системы. Единственный вариант очистить справочник -- это выполнить полную очистку данных предприятия.

```json
{
  "version": "1.0",
  "data": {
    "148484314_1177198742": {
      "type": "ACCRUAL",
      "name": {
        "ru": {
          "name": "13 зарплата"
        }
      }
    },
    "810210647_991893850": {
      "type": "ACCRUAL",
      "name": {
        "ru": {
          "name": "2,31"
        }
      }
    },
```

## ZZZZZZ.json

Вся информация о начислениях, удержаниях, налогах и т.п. по сотруднику хранится в одном файле. Здесь же хранится история подразделений и должностей сотрудника. Отдельные справочники должностей и подразделений не заводятся. В дальнейшем, расчетный листок формируется путем фильтрации данных, которые попадают в диапазон расчетного листка. При загрузке из сторонней системы данные **объединяются**. Т.е. новые записи добавляются, существующие заменяются. При этом идентификация позиции расчетного листка происходит по ИД типа и точному совпадению диапазона дат. Идентификация позиции в изменении должности/подразделения идет по точному совпадению диапазона.

```json
{
  "version": "1.0",
  "data": {
    "emplId": "147471805_991395044",
    "dept": [
      {
        "id": "5437654_635476",
        "name": {
          "ru": {
            "name": "адм. руководящие работники и главные специалисты"
          }
        },
        "db": "2019.2.1",
        "de": "2019.2.28"
      }
    ],
    "pos": [
      {
        "id": "5437654_635476",
        "name": {
          "ru": {
            "name": "заместитель  генерального директора по финансовым вопросам и"
          }
        },
        "db": "2019.02.01",
        "de": "2019.02.28"
      }
    ],
    "hiringDate": "2016.10.17",
    "data": [
      {
        "typeId": "saldo",
        "db": "2019.02.01",
        "de": "2019.02.28",
        "s": 636.62
      },
      {
        "typeId": "147567125_119619099",
        "db": "2019.02.01",
        "de": "2019.02.28",
        "s": 598.34,
        "det": {
          "hours": 160,
          "days": 20
        }
      },
```

### Пример:

Сотрудник работал так:

```

  |--pos1--|---pos2--|----------------pos3--|-pos4----|
=======================================================
| jan |  feb   |  mar  |  apr  |  may  | june |  jul  |
=======================================================
               ^----upload data--------^
```

При выгрузке на сервер данных за указанный период -- с 1 марта по 31 мая, будут переданы следующие данные:

1. Информация о нахождении в должности pos2 с 20 февраля по 25 марта.
1. Информация о нахождении в должности pos3 с 25 марта по 20 июня.
1. Все начисления/налоги/удержания и т.п. за период 01 марта -- 31 мая.

Примечание: информация о принадлежности подразделениям передается аналогично.